define(["../core","./var/nonce","./var/rquery","../ajax"],function(e,t,n){"use strict";var r=[],i=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=r.pop()||e.expando+"_"+t++;return this[n]=!0,n}}),e.ajaxPrefilter("json jsonp",function(t,o,s){var a,u,l,c=t.jsonp!==!1&&(i.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&i.test(t.data)&&"data");return c||"jsonp"===t.dataTypes[0]?(a=t.jsonpCallback=e.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,c?t[c]=t[c].replace(i,"$1"+a):t.jsonp!==!1&&(t.url+=(n.test(t.url)?"&":"?")+t.jsonp+"="+a),t.converters["script json"]=function(){return l||e.error(a+" was not called"),l[0]},t.dataTypes[0]="json",u=window[a],window[a]=function(){l=arguments},s.always(function(){void 0===u?e(window).removeProp(a):window[a]=u,t[a]&&(t.jsonpCallback=o.jsonpCallback,r.push(a)),l&&e.isFunction(u)&&u(l[0]),l=u=void 0}),"script"):void 0})});
