"use strict";function markdown2html(e){var t=new Markdown;return t.render(e.trim()).slice(3,-5)}function Section(e,t){this.heading=e.trim(),this.id=this.heading.replace(/\s+/g,"-").toLowerCase(),this.customizable=t,this.docstring=null,this.subsections=[]}function SubSection(e){this.heading=e.trim(),this.id=this.heading.replace(/\s+/g,"-").toLowerCase(),this.variables=[]}function VarDocstring(e){this.html=markdown2html(e)}function SectionDocstring(e){this.html=markdown2html(e)}function Variable(e,t){this.name=e,this.defaultValue=t,this.docstring=null}function Tokenizer(e){this._lines=e.split("\n"),this._next=void 0}function Parser(e){this._tokenizer=new Tokenizer(e)}var Markdown=require("markdown-it"),CUSTOMIZABLE_HEADING=/^[\/]{2}={2}(.*)$/,UNCUSTOMIZABLE_HEADING=/^[\/]{2}-{2}(.*)$/,SUBSECTION_HEADING=/^[\/]{2}={3}(.*)$/,SECTION_DOCSTRING=/^[\/]{2}#{2}(.+)$/,VAR_ASSIGNMENT=/^(@[a-zA-Z0-9_-]+):[ ]*([^ ;][^;]*);[ ]*$/,VAR_DOCSTRING=/^[\/]{2}[*]{2}(.+)$/;Section.prototype.addSubSection=function(e){this.subsections.push(e)},SubSection.prototype.addVar=function(e){this.variables.push(e)},Tokenizer.prototype.unshift=function(e){if(void 0!==this._next)throw new Error("Attempted to unshift twice!");this._next=e},Tokenizer.prototype._shift=function(){if(void 0!==this._next){var e=this._next;return this._next=void 0,e}if(this._lines.length<=0)return null;var t=this._lines.shift(),n=null;if(n=SUBSECTION_HEADING.exec(t),null!==n)return new SubSection(n[1]);if(n=CUSTOMIZABLE_HEADING.exec(t),null!==n)return new Section(n[1],!0);if(n=UNCUSTOMIZABLE_HEADING.exec(t),null!==n)return new Section(n[1],!1);if(n=SECTION_DOCSTRING.exec(t),null!==n)return new SectionDocstring(n[1]);if(n=VAR_DOCSTRING.exec(t),null!==n)return new VarDocstring(n[1]);var r=t.lastIndexOf("//"),i=-1===r?t:t.slice(0,r);return n=VAR_ASSIGNMENT.exec(i),null!==n?new Variable(n[1],n[2]):void 0},Tokenizer.prototype.shift=function(){for(;;){var e=this._shift();if(void 0!==e)return e}},Parser.prototype.parseFile=function(){for(var e=[];;){var t=this.parseSection();if(null===t){if(null!==this._tokenizer.shift())throw new Error("Unexpected unparsed section of file remains!");return e}e.push(t)}},Parser.prototype.parseSection=function(){var e=this._tokenizer.shift();if(null===e)return null;if(!(e instanceof Section))throw new Error("Expected section heading; got: "+JSON.stringify(e));var t=this._tokenizer.shift();return t instanceof SectionDocstring?e.docstring=t:this._tokenizer.unshift(t),this.parseSubSections(e),e},Parser.prototype.parseSubSections=function(e){for(;;){var t=this.parseSubSection();if(null===t){if(0!==e.subsections.length)break;t=new SubSection(""),this.parseVars(t)}e.addSubSection(t)}1!==e.subsections.length||e.subsections[0].heading||0!==e.subsections[0].variables.length||(e.subsections=[])},Parser.prototype.parseSubSection=function(){var e=this._tokenizer.shift();return e instanceof SubSection?(this.parseVars(e),e):(this._tokenizer.unshift(e),null)},Parser.prototype.parseVars=function(e){for(;;){var t=this.parseVar();if(null===t)return;e.addVar(t)}},Parser.prototype.parseVar=function(){var e=this._tokenizer.shift();e instanceof VarDocstring||(this._tokenizer.unshift(e),e=null);var t=this._tokenizer.shift();return t instanceof Variable?(t.docstring=e,t):(this._tokenizer.unshift(t),null)},module.exports=Parser;
